<?xml version="1.0" encoding="utf-8"?>
<diff>
  <!-- HDS_YVARY: inject sphere offset around the nearest gravidar-obscuring position -->
  <add
    sel="//library[@name='GetGravidarObscuringSectorPosition']//get_safe_pos[@result='$SafePos' and @radius='$SafeposRadius' and @value='$NearestPos' and @min='1km' and @max='10km' and @allowyaxis='false' and @includeplotbox='true' and @sector='$Sector']"
    pos="before">
    <run_actions ref="md.hds_rng_sphere_lib.HDS_RNG_Sphere_RandPoint" result="$SpherePos">
      <param name="center" value="$NearestPos"/>
      <param name="R"      value="10km"/>
      <param name="squash" value="1.0f"/>
    </run_actions>
  </add>

  <!-- Replace the original safety call to use our offset and drop min/max/allowyaxis -->
  <replace
    sel="//library[@name='GetGravidarObscuringSectorPosition']//get_safe_pos[@result='$SafePos' and @radius='$SafeposRadius' and @value='$NearestPos' and @min='1km' and @max='10km' and @allowyaxis='false' and @includeplotbox='true' and @sector='$Sector']">
    <get_safe_pos result="$SafePos"
                  radius="$SafeposRadius"
                  value="$SpherePos"
                  includeplotbox="true"
                  sector="$Sector"/>
  </replace>
</diff>
